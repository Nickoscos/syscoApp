{% extends 'polls/header.html' %}

{% block cssfile %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/chaufferie.css' %}">
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <h1>Génération de la liste de points</h1>
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <!-- Formulaire 1 téléchargement template Liste de points -->
            <form method="post" id="downloadListTemplate" class="form">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="downloadListTemplate">
                <button type="submit" class="btn btn-secondary">Télécharger liste de points</button>    
            </form>
        </div>
    </div>
    <p>
        Cette page permet de générer la liste de points en fonction de la constitution de la chaufferie ou de la sous-station. Le bouton "Template Liste de points"
        vous permet aussi de concevoir vous même la liste de points depuis excel.
    </p>

    <span style="color:red">{{message}}</span>
    <br>
    <br>
    <!-- Formulaire 1 de configuration de la chaufferie -->
    <form method="post" id="nbChaudform" class="form">
        <fieldset class="container-fluid border border-primary rounded">
            <div class="row"> 
                <legend>Configuration de la chaufferie </legend>
            </div>
            
            {% csrf_token %}

            <div class="row m-1">
                <fieldset class="container-fluid col mt-1 me-1 pb-1 border border-primary rounded">
                    <legend class="text-center">Chaudières</legend>
                    <label>Nombres de chaudières: </label>
                    <input name="nbChaudiere" id="nbChaudiere" type="number" value="{{ chaufferie.nbChaudiere }}">
                </fieldset>

                <fieldset class="container-fluid col mt-1 me-1 pb-1 border border-primary rounded">
                    <legend class="text-center">ECS</legend>
                    <label>ECS présent: </label>
                    <input name="ECSpres" id="ECSpres" type="checkbox" style="width:30px;height:30px;" value="{{ chaufferie.ECSpres }}" {% if chaufferie.ECSpres %} checked {% endif %}>
                    <label>Préparateur indépendant: </label>
                    <input name="ECSprepa" id="ECSprepa" type="checkbox" style="width:30px;height:30px;" value="{{ chaufferie.ECSprepa }}" {% if chaufferie.ECSprepa %} checked {% endif %}>
                </fieldset>
                
                <fieldset class="container-fluid col mt-1 me-1 pb-1 border border-primary rounded">
                    <legend class="text-center">Circuits</legend>
                    <label>Nombres de circuits: </label>
                    <input name="nbCircReg" id="nbCircReg" type="number" value="{{ chaufferie.nbCircReg }}">
                </fieldset>

                <fieldset class="container-fluid col mt-1 me-1 pb-1 border border-primary rounded">
                    <legend class="text-center">Autres:</legend>
                    <label>Nombres d'équipements divers: </label>
                    <input name="nbDivers" id="nbDivers" type="number" value="{{ chaufferie.nbDivers }}">
                </fieldset>

                <div class="col mt-1">
                </div>

                <div class="col d-flex justify-content-end mt-1">
                    <input type="hidden" name="form_type" value="nbChaudform">
                    <!-- <input type="submit" value="OK" class="btn btn-primary"> -->
                    <button type="submit" class="btn btn-primary">Configuration</button>
                </div>                
            </div>
        </fieldset>
    </form>

    <!-- Formulaire 2 de configuration de chaque composant -->
    <form action="" method="post" id="chaudform">
        {% csrf_token %}
        <!-- CONFIGURATION CHAUDIERES -->
        {% for c in chaufferie.Chaudieres %}
        <fieldset class="container-fluid mt-1 pb-1 border border-warning rounded">
            <div class="row">
                <legend>Chaudière {{ c.num }}</legend>
            </div>
            
            <div class="row m-1">
                <div class="col mt-1">
                    <label class="row">Nom chaudières: </label>
                    <input class="row" name="nomChaud{{ c.num }}" id="nomChaud{{ c.num }}" type="text" value="{{ c.nomChaud }}">
                </div>

                <div class="col mt-1">
                    <label class="row">Nombre de synthèse défauts: </label>
                    <input class="row" name="nbDef{{ c.num }}" id="nbDef{{ c.num }}" type="number" value="{{ c.nbDef }}">
                </div>

                <div class="col mt-1">
                    <label class="row">Nombre de Température: </label>
                    <input class="row" name="nbTemp{{ c.num }}" id="nbTemp{{ c.num }}" type="number" value="{{ c.nbTemp }}">
                </div>

                <div class="col mt-1">
                    <label class="row">Nombre de pompes: </label>
                    <input class="row" name="nbPpeChaud{{ c.num }}" id="nbPpeChaud{{ c.num }}" type="number" value="{{ c.nbPpe }}">
                </div>

                <div class="col mt-1">
                    <label class="row">Nombre de V2V: </label>
                    <input class="row" name="nbV2VChaud{{ c.num }}" id="nbV2VChaud{{ c.num }}" type="number" value="{{ c.nbV2V }}">        
                </div>

                <div class="col mt-1">       
                </div>

                <div class="col mt-1">       
                </div>
            </div>
        </fieldset>
        {% endfor %}
        <!-- CONFIGURATION EQUIPEMENTS DIVERS -->
        {% for d in chaufferie.Divers %}
        <fieldset class="container-fluid mt-1 pb-1 border border-warning rounded">
            <div class="row">
                <legend>Divers {{ d.num }}</legend>
            </div>

            <div class="row m-1">
                <div class="col mt-1">
                    <label class="row">Nom équipement: </label>
                    <input class="row" name="nomDivers{{ d.num }}" id="nomDivers{{ d.num }}" type="text" value="{{ d.nomDivers }}">
                </div>
    
                <div class="col mt-1">
                    <label class="row">Nom équipement: </label>
                    <input class="row" name="nomDivers{{ d.num }}" id="nomDivers{{ d.num }}" type="text" value="{{ d.nomDivers }}">
                </div>
    
                <div class="col mt-1">
                    <label class="row">Nombre d'infos supplémentaires: </label>
                    <input class="row" name="nbTSsupDivers{{ d.num }}" id="nbTSsupDivers{{ d.num }}" type="number" value="{{ d.nbTSsup }}">
                </div>
    
                <div class="col mt-1">
                    <label class="row">Nombre de pompes: </label>
                    <input class="row" name="nbPpeDivers{{ d.num }}" id="nbPpeDivers{{ d.num }}" type="number" value="{{ d.nbPpe }}">
                </div>
    
                <div class="col mt-1">
                    <label class="row">Nombre de V2V: </label>
                    <input class="row" name="nbV2VDivers{{ d.num }}" id="nbV2VDivers{{ d.num }}" type="number" value="{{ d.nbV2V }}">
                </div>

                <div class="col mt-1">
                </div>
            </div>
            
        </fieldset>
        {% endfor %}
        <!-- CONFIGURATION CIRCUITS REGULES -->
        {% for c in chaufferie.CircReg %}
        <fieldset class="container-fluid mt-1 pb-1 border border-warning rounded">
            <div class="row">
                <legend>Circuit régulé {{ c.num }}</legend>
            </div>

            <div class="row m-1">
                <div class="col mt-1">
                    <label class="row">Nom circuit régulé: </label>
                    <input class="row" name="nomCircReg{{ c.num }}" id="nomCircReg{{ c.num }}" type="text" value="{{ c.nomCirc }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de Température Eau: </label>
                    <input class="row" name="nbTempCircReg{{ c.num }}" id="nbTempCircReg{{ c.num }}" type="number" value="{{ c.nbTemp }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de Température Ambiant (filaire): </label>
                    <input class="row" name="nbAmbCircReg{{ c.num }}" id="nbAmbCircReg{{ c.num }}" type="number" value="{{ c.nbAmb }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de pompes: </label>
                    <input class="row" name="nbPpeCircReg{{ c.num }}" id="nbPpeCircReg{{ c.num }}" type="number" value="{{ c.nbPpe }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de V3V: </label>
                    <input  class="row"name="nbV3VCircReg{{ c.num }}" id="nbV3VCircReg{{ c.num }}" type="number" value="{{ c.nbV3V }}">
                </div>

                <div class="col mt-1">
                </div>

            </div>
        </fieldset>
        {% endfor %}       
        <!-- CONFIGURATION ECS -->
        {% for c in chaufferie.ECS %}
        <fieldset class="container-fluid mt-1 pb-1 border border-warning rounded">
            <div class="row">
                <legend>ECS {{ c.num }}</legend>
            </div>

            <div class="row m-1">
                <div class="col mt-1">
                    <label class="row">Nom ECS: </label>
                    <input class="row" name="nomECS{{ c.num }}" id="nomECS{{ c.num }}" type="text" value="{{ c.nomECS }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de défauts: </label>
                    <input class="row" name="nbDef{{ c.num }}" id="nbDef{{ c.num }}" type="number" value="{{ c.nbDef }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de ballon: </label>
                    <input class="row" name="nbBallonECS{{ c.num }}" id="nbBallonECS{{ c.num }}" type="number" value="{{ c.nbBallon }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de sonde Température: </label>
                    <input class="row" name="nbTempECS{{ c.num }}" id="nbTempECS{{ c.num }}" type="number" value="{{ c.nbTemp }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de pompes: </label>
                    <input class="row" name="nbPpeECS{{ c.num }}" id="nbPpeECS{{ c.num }}" type="number" value="{{ c.nbPpe }}">
                </div>
                <div class="col mt-1">
                    <label class="row">Nombre de V3V: </label>
                    <input  class="row"name="nbV3VECS{{ c.num }}" id="nbV3VECS{{ c.num }}" type="number" value="{{ c.nbV3V }}">
                </div>
                <div class="col mt-1">
                </div>
            </div>
        </fieldset>
        {% endfor %}

        <div class="col d-flex justify-content-end mt-1">
            <input type="hidden" name="form_type" value="chaudform">
            <!-- <input type="submit" value="Valider configuration"> -->
            <button type="submit" class="btn btn-success">Générer liste de points</button>
        </div>    
    </form>

    <!-- AFFICHAGE DE LA LISTE DE POINTS -->
    <form action="" method="post" id="listform">
        {% if listePts.pts|length > 0 %}
        <div class="col d-flex justify-content-end mt-1">
            <input type="hidden" name="form_type" value="listform">
            <button type="submit" class="btn btn-warning">Actualiser liste</button>
        </div>   
        {% endif %}
        {% csrf_token %}
        <table class="table text-center mt-2">
            <thead>
                <tr>
                    <th colspan="7" style="background-color: gray; font-size: 1.3em;">LISTE DE POINTS</th>
                </tr>
                <tr style="background-color: gray;">
                    <th class="col-2">Sous-ensemble</th>
                    <th class="col-5">Libellé</th>
                    <th class="col-1">TM Température</th>
                    <th class="col-1">TS Digital</th>
                    <th class="col-1">TR 0-10V</th>
                    <th class="col-1">TC Digital</th>
                    <th class="col-1">Suppression</th>
                </tr>
            </thead>
            <tbody>
                {% for l in listePts.pts %}
                    {% if forloop.last %}
                    <tr style="background-color: gray;">
                        <td class="col-2">{{ l.equip }}</td>
                        <td class="col-5">{{ l.libelle }}</td>
                        <td class="col-1">{{ l.TM }}</td>
                        <td class="col-1">{{ l.TS }}</td>
                        <td class="col-1">{{ l.TR }}</td>
                        <td class="col-1">{{ l.TC }}</td>
                        <td class="col-1"></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="col-2"><input name="nomEquip{{ forloop.counter0 }}" id="nomEquip{{ forloop.counter0 }}" type="text" style="width: 100%;" value="{{ l.equip }}"></td>
                        <td class="col-5"><input name="libelle{{ forloop.counter0 }}" id="libelle{{ forloop.counter0 }}" type="text" style="width: 100%;" value="{{ l.libelle }}"></td>
                        <td class="col-1"><input name="TM{{ forloop.counter0 }}" id="TM{{ forloop.counter0 }}" type="number" value="{{ l.TM }}"></td>
                        <td class="col-1"><input name="TS{{ forloop.counter0 }}" id="TS{{ forloop.counter0 }}" type="number" value="{{ l.TS }}"></td>
                        <td class="col-1"><input name="TR{{ forloop.counter0 }}" id="TR{{ forloop.counter0 }}" type="number" value="{{ l.TR }}"></td>
                        <td class="col-1"><input name="TC{{ forloop.counter0 }}" id="TC{{ forloop.counter0 }}" type="number" value="{{ l.TC }}"></td>
                        <td class="col-1">
                            <form action="" method="post" id="deleteForm">
                                {% csrf_token %}
                                <input type="hidden" name="form_type" value="deleteForm">
                                <button type="submit" class="btn btn-danger" name="Supp" id="Supp" value={{forloop.counter0}}>Suppr</button></td>
                            </form>
                            
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>   
    </form>
    <form action="" method="post" id="exportExcelList">
        {% csrf_token %}
        <div class="col d-flex justify-content-end mt-1">
            <input type="hidden" name="form_type" value="exportExcelList">
            <button type="submit" class="btn btn-primary">Export Liste en xls</button>
        </div> 
    </form>

{% endblock %}